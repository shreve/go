#!/usr/bin/env ruby

require 'json'
require 'fileutils'

class Generator
  def initialize(db)
    @db = db
  end

  def generate
    generate_links
    generate_index
  end

  def generate_links
    template = File.read(File.join(template_path, 'link.html'))

    @db.each_pair do |code, url|
      File.open(File.join(output_path, "#{code}.html"), 'w+') do |file|
        file.write template.gsub('{{url}}', url)
      end
    end
  end

  def generate_index
    path = File.join(output_path, 'this.html')
    if File.exist?(path)
      FileUtils.copy(path, File.join(output_path, 'index.html'))
    end
  end

  private

  def output_path
    File.expand_path('./docs')
  end

  def template_path
    File.expand_path('./templates')
  end
end

database = File.read(File.join(File.expand_path('./'), 'links.json'))
database = JSON.parse(database)

Generator.new(database).generate
